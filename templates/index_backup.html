<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Othello AI</title>
  <style>
    body {
      background: #184a2c;
      color: #f5f5f5;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      margin: 0;
    }

    h1 { margin-top: 15px; }

    .board {
      display: grid;
      grid-template-columns: repeat(8, 50px);
      grid-template-rows: repeat(8, 50px);
      gap: 2px;
      justify-content: center;
      margin: 20px auto;
      width: fit-content;
    }

    .cell {
      width: 50px;
      height: 50px;
      background: #107010;
      border-radius: 6px;
      position: relative;
      cursor: pointer;
      transition: background 0.2s;
    }

    .cell.black::after,
    .cell.white::after {
      content: '';
      position: absolute;
      top: 50%; left: 50%;
      width: 38px; height: 38px;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 0px rgba(0,0,0,0.4);
    }

    .cell.black::after { background: black; }
    .cell.white::after { background: white; }

 border-radius: 0%;
      transform: translate(-50%, -50%);
    }

    .controls {
      margin: 10px auto;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }
  /* üåü Highlight hi·ªáu ·ª©ng 2 v√≤ng */
  .highlight::before {
    content: "";
    position: absolute;
    width: 12px;
    height: 12px;
    background-color: white;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0.9;
  }

  .highlight::after {
    content: "";
    position: absolute;
    width: 18px;
    height: 18px;
    background-color: rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0.4;
  }

  #controls {
    margin-top: 15px;
  }

  label {
    margin: 0 10px;
  }
  </style>
</head>
<body>
  <h1>C·ªù L·∫≠t - Ng∆∞·ªùi vs AI</h1>

  <div class="controls">
    <label>ƒê·ªô kh√≥:</label>
    <select id="depthSelect">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3" selected>3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
    </select>

    <span>Ch·ªçn m√†u c·ªù:</span>
    <label><input type="radio" name="color" value="black" checked> ‚ö´ ƒêen</label>
    <label><input type="radio" name="color" value="white"> ‚ö™ Tr·∫Øng</label>

    <button id="toggleFirst">Ng∆∞·ªùi ƒëi tr∆∞·ªõc</button>
    <button id="reset">Ch∆°i l·∫°i</button>
  </div>

  <div class="scoreboard">
    ‚ö™ Tr·∫Øng: <span id="whiteScore">2</span> |
    ‚ö´ ƒêen: <span id="blackScore">2</span>
  </div>

  <div class="board" id="board"></div>

  <script>
    const SIZE = 8;
    let boardEl = document.getElementById('board');
    let depthSelect = document.getElementById('depthSelect');
    let whiteScoreEl = document.getElementById('whiteScore');
    let blackScoreEl = document.getElementById('blackScore');

    let playerColor = 'black';
    let aiColor = 'white';
    let humanFirst = true;

    let grid = [];
    let currentTurn = 'black';

    function initGrid() {
      grid = Array(SIZE).fill().map(()=>Array(SIZE).fill(null));
      grid[3][3] = 'white';
      grid[4][4] = 'white';
      grid[3][4] = 'black';
      grid[4][3] = 'black';
      currentTurn = 'black';
      renderBoard();
      updateScore();
      highlightMoves();
      if (!humanFirst && aiColor === 'black') aiPlay();
    }

    function renderBoard() {
      boardEl.innerHTML = '';
      for (let y = 0; y < SIZE; y++) {
        for (let x = 0; x < SIZE; x++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          if (grid[y][x]) cell.classList.add(grid[y][x]);
          cell.onclick = () => handleMove(x, y);
          boardEl.appendChild(cell);
        }
      }
    }

    function updateScore() {
      let white = 0, black = 0;
      for (let row of grid) {
        for (let c of row) {
          if (c === 'white') white++;
          if (c === 'black') black++;
        }
      }
      whiteScoreEl.textContent = white;
      blackScoreEl.textContent = black;
    }

    function validMoves(color) {
      const dirs = [[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]];
      const moves = [];
      for (let y=0; y<SIZE; y++) {
        for (let x=0; x<SIZE; x++) {
          if (grid[y][x]) continue;
          let flips = [];
          for (let [dx,dy] of dirs) {
            let nx=x+dx, ny=y+dy, temp=[];
            while(nx>=0&&nx<SIZE&&ny>=0&&ny<SIZE){
              let p=grid[ny][nx];
              if(!p) break;
              if(p===color){ if(temp.length) flips.push(...temp); break;}
              temp.push([nx,ny]);
              nx+=dx; ny+=dy;
            }
          }
          if (flips.length) moves.push({x,y,flips});
        }
      }
      return moves;
    }

    function highlightMoves() {
      const moves = validMoves(playerColor);
      const cells = boardEl.children;
      for (let cell of cells) cell.classList.remove('highlight');
      for (let m of moves) {
        const index = m.y * SIZE + m.x;
        cells[index].classList.add('highlight');
      }
    }

    function applyMove(x,y,color,flips){
      grid[y][x]=color;
      for(let [fx,fy] of flips) grid[fy][fx]=color;
      renderBoard();
      updateScore();
      highlightMoves();
    }

    async function handleMove(x,y){
      if (currentTurn!==playerColor) return;
      const moves = validMoves(playerColor);
      const move = moves.find(m=>m.x===x&&m.y===y);
      if(!move) return;

      applyMove(x,y,playerColor,move.flips);
      currentTurn = aiColor;
      highlightMoves();
      await aiPlay();
    }

    async function aiPlay(){
      const depth = parseInt(depthSelect.value);
      const res = await fetch("/ai_move", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({grid, depth})
      });
      const data = await res.json();
      const move = data.move;
      if(!move){ currentTurn = playerColor; highlightMoves(); return; }

      const moves = validMoves(aiColor);
      const m = moves.find(m=>m.x===move[0]&&m.y===move[1]);
      if(!m){ currentTurn = playerColor; highlightMoves(); return; }

      applyMove(m.x,m.y,aiColor,m.flips);
      currentTurn = playerColor;
      highlightMoves();
    }

    // --- Event Listeners ---
    document.querySelectorAll('input[name="color"]').forEach(radio=>{
      radio.addEventListener('change', e=>{
        playerColor = e.target.value;
        aiColor = playerColor === 'black' ? 'white' : 'black';
        initGrid();
      });
    });

    document.getElementById('toggleFirst').onclick = () => {
      humanFirst = !humanFirst;
      document.getElementById('toggleFirst').textContent =
        humanFirst ? "Ng∆∞·ªùi ƒëi tr∆∞·ªõc" : "AI ƒëi tr∆∞·ªõc";
      initGrid();
      if (!humanFirst) aiPlay();
    };

    document.getElementById('reset').onclick = () => initGrid();

    initGrid();
  </script>
</body>
</html>